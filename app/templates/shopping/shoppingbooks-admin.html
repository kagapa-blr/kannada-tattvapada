<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Shopping Books - Admin</title>
  <!-- Favicon -->
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@400;700&display=swap" rel="stylesheet" />

  <!-- CSS SECTION -->
  <!-- Bootstrap CSS (local) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" />
  <!-- DataTables CSS (local) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='cdn/dataTables/dataTables.dataTables.min.css') }}" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/shopping/shopping-admin.css') }}" />

  <!-- JS LIBRARIES SECTION (local) -->
  <script type="module" src="{{ url_for('static', filename='js/shopping/shopping-admin.js') }}"></script>
  <!-- jQuery (local) -->
  <script src="{{ url_for('static', filename='cdn/dataTables/jquery-3.7.1.js') }}"></script>
  <!-- DataTables JS (local) -->
  <script src="{{ url_for('static', filename='cdn/dataTables/dataTables.min.js') }}"></script>
  <!-- Bootstrap Bundle JS (local) -->
  <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">

</head>

<body>
  <div class="container py-5">
    <h2 class="mb-4 text-center text-primary fw-bold">Manage Books</h2>

    <div class="top-controls">
      <div class="btn-group">
        <button class="btn btn-success" id="addBookBtn">Add New Book</button>
        <button class="btn btn-primary" id="autoFillBtn">Auto Fill</button>
        <button class="btn btn-secondary" id="refreshBtn">Refresh</button>
      </div>
      <div class="d-flex justify-content-end mb-3">
        <div class="d-flex" style="width: 300px; gap: 10px;">
          <input type="text" id="manualSearchInput" class="form-control form-control-sm" placeholder="Search books...">
          <button class="btn btn-primary btn-sm" id="searchBtn">Search</button>
        </div>
      </div>
    </div>

    <div class="text-center my-3">
      <div class="spinner-border text-primary" role="status" id="loadingSpinner">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <table id="booksTable" class="table table-striped table-bordered w-100">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Cover</th>
          <th>Title</th>
          <th>Author</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Rating</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Modal: Add/Edit Book -->
  <div class="modal fade" id="bookModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static"
    data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="bookForm" novalidate>
          <div class="modal-header bg-light">
            <h5 class="modal-title fw-bold">Book Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <input type="hidden" name="id" id="bookId" />

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Title *</label>
                <input type="text" class="form-control" name="title" placeholder="Enter book title" required />
                <div class="invalid-feedback">Title is required.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Subtitle</label>
                <input type="text" class="form-control" name="subtitle" placeholder="Enter book subtitle" />
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <label class="form-label">Author</label>
                <input type="text" class="form-control" name="author_name" placeholder="Author name" />
              </div>
              <div class="col-md-6">
                <label class="form-label">Language</label>
                <input type="text" class="form-control" name="language" placeholder="Language" />
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-3">
                <label class="form-label">Price *</label>
                <input type="number" step="0.01" class="form-control" name="price" required />
                <div class="invalid-feedback">Price is required.</div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Discount Price</label>
                <input type="number" step="0.01" class="form-control" name="discount_price" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Stock *</label>
                <input type="number" class="form-control" name="stock_quantity" required />
                <div class="invalid-feedback">Stock is required.</div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Pages</label>
                <input type="number" class="form-control" name="number_of_pages" />
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-4">
                <label class="form-label">Book Code</label>
                <input type="text" class="form-control" name="book_code" placeholder="Book code" />
              </div>
              <div class="col-md-4">
                <label class="form-label">Catalog Number</label>
                <input type="text" class="form-control" name="catalog_number" placeholder="Catalog number" />
              </div>
              <div class="col-md-4">
                <label class="form-label">Publisher</label>
                <input type="text" class="form-control" name="publisher_name" placeholder="Publisher name" />
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-4">
                <label class="form-label">Publication Date</label>
                <input type="date" class="form-control" name="publication_date" />
              </div>
              <div class="col-md-8">
                <label class="form-label">Description</label>
                <textarea class="form-control" name="description" rows="3"
                  placeholder="Short description..."></textarea>
              </div>
            </div>

            <!-- New Rating Field -->
            <div class="row g-3 mt-3">
              <div class="col-md-4">
                <label class="form-label">Rating (1 - 5)</label>
                <input type="number" step="0.1" min="1" max="5" class="form-control" name="rating"
                  placeholder="Enter rating" />
              </div>
            </div>

            <div class="mb-3 mt-3">
              <label class="form-label">Cover Image</label>
              <input type="file" class="form-control" name="cover_file" id="coverFileInput" accept="image/*" />
              <img id="coverPreview" src="" alt="Cover Preview" class="d-none border mt-2 rounded" />
            </div>

            <!-- Error message display -->
            <div class="alert alert-danger d-none" id="formError"></div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary" id="saveBtn">Save</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelBtn">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Auto Fill from Tatvapada -->
  <div class="modal fade" id="autoFillModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static"
    data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <form id="autoFillForm">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title">Auto Fill from Tatvapada</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-info small">
              <strong>Notes:</strong> This will create books automatically from <code>Tatvapada</code> table.<br />
              - <strong>Title</strong> → <code>tatvapadakosha_sheershike</code><br />
              - <strong>Author</strong> → <code>tatvapadakarara_hesaru</code><br />
              - Other fields will be filled later manually.
            </div>

            <div class="mb-3">
              <label class="form-label">Default Price (₹)*</label>
              <input type="number" step="0.01" class="form-control" name="default_price" required />
              <div class="invalid-feedback">Default price is required</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Default Stock</label>
              <input type="number" class="form-control" name="stock_quantity" value="0" />
            </div>

            <div class="mb-3">
              <label class="form-label">Notes (Optional)</label>
              <textarea class="form-control" name="notes" rows="2" placeholder="Notes about this batch..."></textarea>
            </div>

            <!-- Error message display -->
            <div class="alert alert-danger d-none" id="autoFillError"></div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Auto Fill</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
              id="autoFillCancelBtn">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmation -->
  <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel"
    aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-warning">
          <h5 class="modal-title" id="confirmationModalLabel">Confirm Action</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="confirmationModalBody">
          Are you sure you want to delete this book?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Error Display -->
  <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="errorModalLabel">Error</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="errorModalBody">
          <!-- Error message inserted here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


</body>
{% include 'footer.html' %}

</html>