<!DOCTYPE html>
<html lang="kn">

<head>
  <meta charset="UTF-8">
  <title>‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤™‡≤ü‡≥ç‡≤ü‡≤ø</title>

  <!-- ‚úÖ CSS Dependencies -->
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='cdn/dataTables/dataTables.dataTables.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
</head>

<body>

  {% include 'navbar.html' %}

  <div class="container mt-4">
    <h2>üìñ ‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤™‡≤ü‡≥ç‡≤ü‡≤ø</h2>

    <table id="tippaniTable" class="display stripe hover table table-bordered" style="width:100%">
      <thead>
        <tr>
          <th>‡≤∏‡≤Ç‡≤™‡≥Å‡≤ü ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü</th>
          <th>‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å</th>
          <th>‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤ê‡≤°‡≤ø</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- ‚úÖ Modal for Tippani Details -->
  <div class="modal fade" id="tippaniModal" tabindex="-1" aria-labelledby="tippaniModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="tippaniModalLabel">‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≥Å</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p><strong>‡≤∏‡≤Ç‡≤™‡≥Å‡≤ü ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü:</strong> <span id="modalSamputa"></span></p>
          <p><strong>‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å:</strong> <span id="modalAuthor"></span></p>
          <p><strong>‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤ê‡≤°‡≤ø:</strong> <span id="modalId"></span></p>
          <hr>
          <p><strong>‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤µ‡≤ø‡≤∑‡≤Ø:</strong></p>
          <p id="modalContent" class="modal-text"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  {% include 'footer.html' %}

  <!-- ‚úÖ JS Dependencies -->
  <script src="{{ url_for('static', filename='cdn/dataTables/jquery-3.7.1.js') }}"></script>
  <script src="{{ url_for('static', filename='cdn/dataTables/dataTables.min.js') }}"></script>
  <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/navbar.js') }}"></script>

  <!-- ‚úÖ Script -->
  <script type="module">
    import apiClient from "{{ url_for('static', filename='js/apiClient.js') }}";

    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const data = await apiClient.get("api/v1/right-section/all/tippani");

        if (!data.results || data.results.length === 0) {
          console.warn("No Tippanis found");
          return;
        }

        const table = $("#tippaniTable").DataTable({
          data: data.results,
          columns: [
            { data: "samputa_sankhye", title: "‡≤∏‡≤Ç‡≤™‡≥Å‡≤ü ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü" },
            { data: "tatvapadakarara_hesaru", title: "‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å" },
            { data: "tippani_id", title: "‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤ê‡≤°‡≤ø" }
          ],
          destroy: true,
          searching: true,
          paging: true,
          language: {
            emptyTable: "‡≤ü‡≤ø‡≤™‡≥ç‡≤™‡≤£‡≤ø ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤"
          }
        });

        // ‚úÖ Row click ‚Üí open modal with details
        $('#tippaniTable tbody').on('click', 'tr', function () {
          const rowData = table.row(this).data();
          if (!rowData) return;

          document.getElementById("modalSamputa").textContent = rowData.samputa_sankhye;
          document.getElementById("modalAuthor").textContent = rowData.tatvapadakarara_hesaru;
          document.getElementById("modalId").textContent = rowData.tippani_id;
          document.getElementById("modalContent").textContent = rowData.tippani_content || "‚Äî";

          const modal = new bootstrap.Modal(document.getElementById("tippaniModal"));
          modal.show();
        });
      } catch (err) {
        console.error("Error loading Tippani list:", err);
      }
    });
  </script>

</body>

</html>