<!DOCTYPE html>
<html lang="kn">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞ ‡≤µ‡≤ø‡≤µ‡≤∞</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}" />

  <style>
    body {
      background-color: #f9fafb;
      font-family: "NudiParijatha", "Noto Sans Kannada", sans-serif;
      font-size: 19px;
      /* slightly smaller for balance */
      line-height: 1.75;
      color: #2c2c2c;
    }

    h3 {
      font-weight: 600;
      color: #222;
      letter-spacing: 0.5px;
    }

    .card {
      border-radius: 1rem;
      transition: all 0.4s ease;
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    #authorCard {
      display: none;
      opacity: 0;
      transform: translateY(25px);
    }

    #authorContent {
      opacity: 0;
      transition: opacity 0.6s ease;
      max-height: 65vh;
      overflow-y: auto;
      padding-right: 10px;
      font-size: 18px;
    }

    #authorContent::-webkit-scrollbar {
      width: 8px;
    }

    #authorContent::-webkit-scrollbar-thumb {
      background: #c2c2c2;
      border-radius: 6px;
    }

    #authorContent::-webkit-scrollbar-thumb:hover {
      background: #8a8a8a;
    }

    .btn-primary {
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 18px;
      letter-spacing: 0.3px;
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      border: none;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.3);
    }

    .form-select {
      border-radius: 0.75rem;
      font-size: 18px;
      padding: 0.6rem 0.9rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .meta-text {
      font-size: 0.95rem;
      color: #6c757d;
      font-style: italic;
    }
  </style>

</head>

<body>
  <!-- Navbar -->
  {% include 'navbar.html' %}

  <div class="container my-5">
    <div class="text-center mb-4">
      <h3 class="mb-2">üë§ ‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞ ‡≤µ‡≤ø‡≤µ‡≤∞</h3>
      <p class="text-muted">‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞ ‡≤ú‡≥Ä‡≤µ‡≤® ‡≤ö‡≤∞‡≤ø‡≤§‡≥ç‡≤∞‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤¨‡≤π‡≥Å‡≤¶‡≥Å.</p>
    </div>

    <!-- Author Select & Button -->
    <div class="row g-2 justify-content-center mb-4">
      <div class="col-md-7">
        <select id="authorSelect" class="form-select shadow-sm">
          <option value="">-- ‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø --</option>
        </select>
      </div>
      <div class="col-md-3 d-grid">
        <button id="viewAuthorBtn" class="btn btn-primary shadow-sm">‡≤µ‡≤ø‡≤µ‡≤∞ ‡≤µ‡≥Ä‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤ø</button>
      </div>
    </div>

    <!-- Author Card -->
    <div id="authorCard" class="card shadow-sm border-0">
      <div class="card-body p-4">
        <h4 id="authorName" class="card-title fw-semibold mb-2"></h4>
        <p id="authorCreated" class="meta-text mb-3"></p>
        <div id="authorContent" class="card-text"></div>
      </div>
    </div>
  </div>

  <!-- Custom Loader -->
  {% include 'customLoader.html' %}

  <!-- Footer -->
  {% include 'footer.html' %}

  <!-- Bootstrap JS -->
  <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/navbar.js') }}"></script>

  <script>
    const authorSelect = document.getElementById("authorSelect");
    const viewBtn = document.getElementById("viewAuthorBtn");
    const authorCard = document.getElementById("authorCard");
    const authorName = document.getElementById("authorName");
    const authorCreated = document.getElementById("authorCreated");
    const authorContent = document.getElementById("authorContent");

    // Animate card
    function fadeInCard() {
      authorCard.style.display = "block";
      setTimeout(() => {
        authorCard.style.opacity = "1";
        authorCard.style.transform = "translateY(0)";
      }, 50);
    }

    function resetCardAnimation() {
      authorCard.style.opacity = "0";
      authorCard.style.transform = "translateY(20px)";
    }

    function resetContentAnimation() {
      authorContent.style.opacity = "0";
    }

    function fadeInContent() {
      setTimeout(() => {
        authorContent.style.opacity = "1";
      }, 200);
    }

    // Fetch all authors and populate dropdown
    async function loadAuthors() {
      try {
        const response = await fetch("/api/v1/authors");
        const authors = await response.json();

        authors.forEach(a => {
          const option = document.createElement("option");
          option.value = a.id;
          option.textContent = a.author_name;
          authorSelect.appendChild(option);
        });

        // Auto-load first author if available
        if (authors.length > 0) {
          authorSelect.value = authors[0].id;
          viewAuthor();
        }
      } catch (err) {
        console.error("Failed to load authors:", err);
        alert("‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≥Å ‡≤µ‡≤ø‡≤´‡≤≤‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.");
      }
    }

    // Fetch single author content by ID
    async function viewAuthor() {
      const id = authorSelect.value;
      if (!id) return alert("‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤§‡≤§‡≥ç‡≤µ‡≤™‡≤¶‡≤ï‡≤æ‡≤∞‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü‡≤Æ‡≤æ‡≤°‡≤ø.");

      resetCardAnimation();
      resetContentAnimation();
      fadeInCard();

      authorName.textContent = "Loading...";
      authorCreated.textContent = "";
      authorContent.textContent = "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤ï‡≤æ‡≤Ø‡≤ø‡≤∞‡≤ø...";

      try {
        const response = await fetch(`/api/v1/authors/${id}`);
        if (!response.ok) throw new Error("Author not found");
        const data = await response.json();

        authorName.textContent = data.author_name;
        authorCreated.textContent =
          `üìÖ ‡≤∞‡≤ö‡≤®‡≥Ü: ${data.created_at} | üìù ‡≤®‡≤µ‡≥Ä‡≤ï‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü: ${data.updated_at}`;

        authorContent.innerHTML = data.content || "<em>‡≤µ‡≤ø‡≤µ‡≤∞ ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤.</em>";
        fadeInContent();

      } catch (err) {
        console.error(err);
        authorName.textContent = "";
        authorCreated.textContent = "";
        authorContent.textContent = "‡≤µ‡≤ø‡≤µ‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≥Å ‡≤µ‡≤ø‡≤´‡≤≤‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.";
      }
    }

    viewBtn.addEventListener("click", viewAuthor);

    // Initialize
    loadAuthors();
  </script>
</body>

</html>